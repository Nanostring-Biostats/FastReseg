<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>decide_ReSegment_Operations — decide_ReSegment_Operations • FastReseg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="decide_ReSegment_Operations — decide_ReSegment_Operations"><meta name="description" content="Evaluate neighborhood information against score and transcript number cutoff to decide the resegmetation operations. Use either leiden clustering or geometry statistics to determine whether a merge event is allowed."><meta property="og:description" content="Evaluate neighborhood information against score and transcript number cutoff to decide the resegmetation operations. Use either leiden clustering or geometry statistics to determine whether a merge event is allowed."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-#E6F3FC" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FastReseg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="external-link dropdown-item" href="https://www.nature.com/articles/s41598-025-08733-5">Working principles and Manuscript</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Workflow and core functions</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html">FastReseg to detect and correct segmentation error in spatial transcriptome data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nanostring-Biostats/FastReseg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>decide_ReSegment_Operations</h1>
      <small class="dont-index">Source: <a href="https://github.com/Nanostring-Biostats/FastReseg/blob/HEAD/R/decide_ReSegment_Operations.R" class="external-link"><code>R/decide_ReSegment_Operations.R</code></a></small>
      <div class="d-none name"><code>decide_ReSegment_Operations.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Evaluate neighborhood information against score and transcript number cutoff to decide the resegmetation operations. Use either leiden clustering or geometry statistics to determine whether a merge event is allowed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">decide_ReSegment_Operations</span><span class="op">(</span></span>
<span>  <span class="va">neighborhood_df</span>,</span>
<span>  selfcellID_coln <span class="op">=</span> <span class="st">"CellId"</span>,</span>
<span>  transNum_coln <span class="op">=</span> <span class="st">"transcript_num"</span>,</span>
<span>  selfCellType_coln <span class="op">=</span> <span class="st">"self_celltype"</span>,</span>
<span>  selfScore_coln <span class="op">=</span> <span class="st">"score_under_self"</span>,</span>
<span>  neighborcellID_coln <span class="op">=</span> <span class="st">"neighbor_CellId"</span>,</span>
<span>  neighborCellType_coln <span class="op">=</span> <span class="st">"neighbor_celltype"</span>,</span>
<span>  neighborScore_coln <span class="op">=</span> <span class="st">"score_under_neighbor"</span>,</span>
<span>  score_baseline <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lowerCutoff_transNum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  higherCutoff_transNum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">transcript_df</span>,</span>
<span>  cellID_coln <span class="op">=</span> <span class="st">"CellId"</span>,</span>
<span>  transID_coln <span class="op">=</span> <span class="st">"transcript_id"</span>,</span>
<span>  transSpatLocs_coln <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>  spatialMergeCheck_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"leidenCut"</span>, <span class="st">"geometryDiff"</span><span class="op">)</span>,</span>
<span>  cutoff_spatialMerge <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  leiden_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>objective_function <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPM"</span>, <span class="st">"modularity"</span><span class="op">)</span>, resolution_parameter</span>
<span>    <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0.01</span>, n_iterations <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>  config_spatNW_transcript <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-neighborhood-df">neighborhood_df<a class="anchor" aria-label="anchor" href="#arg-neighborhood-df"></a></dt>
<dd><p>the data.frame containing neighborhood information for each query cells, expected to be output of get_neighborhood_content function.</p></dd>


<dt id="arg-selfcellid-coln">selfcellID_coln<a class="anchor" aria-label="anchor" href="#arg-selfcellid-coln"></a></dt>
<dd><p>the column name of cell_ID of query cell in neighborhood_df</p></dd>


<dt id="arg-transnum-coln">transNum_coln<a class="anchor" aria-label="anchor" href="#arg-transnum-coln"></a></dt>
<dd><p>the column name of transcript number of query cell in neighborhood_df</p></dd>


<dt id="arg-selfcelltype-coln">selfCellType_coln<a class="anchor" aria-label="anchor" href="#arg-selfcelltype-coln"></a></dt>
<dd><p>the column name of cell_type under query cell in neighborhood_df</p></dd>


<dt id="arg-selfscore-coln">selfScore_coln<a class="anchor" aria-label="anchor" href="#arg-selfscore-coln"></a></dt>
<dd><p>the column name of average transcript score under query cell in neighborhood_df</p></dd>


<dt id="arg-neighborcellid-coln">neighborcellID_coln<a class="anchor" aria-label="anchor" href="#arg-neighborcellid-coln"></a></dt>
<dd><p>the column name of cell_ID of neighbor cell in neighborhood_df</p></dd>


<dt id="arg-neighborcelltype-coln">neighborCellType_coln<a class="anchor" aria-label="anchor" href="#arg-neighborcelltype-coln"></a></dt>
<dd><p>the column name of cell_type under neighbor cell in neighborhood_df</p></dd>


<dt id="arg-neighborscore-coln">neighborScore_coln<a class="anchor" aria-label="anchor" href="#arg-neighborscore-coln"></a></dt>
<dd><p>the column name of average transcript score under neighbor cell in neighborhood_df</p></dd>


<dt id="arg-score-baseline">score_baseline<a class="anchor" aria-label="anchor" href="#arg-score-baseline"></a></dt>
<dd><p>a named vector of score baseline for all cell type listed in neighborhood_df such that per cell transcript score higher than the baseline is required to call a cell type of high enough confidence</p></dd>


<dt id="arg-lowercutoff-transnum">lowerCutoff_transNum<a class="anchor" aria-label="anchor" href="#arg-lowercutoff-transnum"></a></dt>
<dd><p>a named vector of transcript number cutoff under each cell type such that higher than the cutoff is required to keep query cell as it is</p></dd>


<dt id="arg-highercutoff-transnum">higherCutoff_transNum<a class="anchor" aria-label="anchor" href="#arg-highercutoff-transnum"></a></dt>
<dd><p>a named vector of transcript number cutoff under each cell type such that lower than the cutoff is required to keep query cell as it is when there is neighbor cell of consistent cell type.</p></dd>


<dt id="arg-transcript-df">transcript_df<a class="anchor" aria-label="anchor" href="#arg-transcript-df"></a></dt>
<dd><p>the data.frame with transcript_id, target/geneName, x, y and cell_id</p></dd>


<dt id="arg-cellid-coln">cellID_coln<a class="anchor" aria-label="anchor" href="#arg-cellid-coln"></a></dt>
<dd><p>the column name of cell_ID in transcript_df</p></dd>


<dt id="arg-transid-coln">transID_coln<a class="anchor" aria-label="anchor" href="#arg-transid-coln"></a></dt>
<dd><p>the column name of transcript_ID in transcript_df</p></dd>


<dt id="arg-transspatlocs-coln">transSpatLocs_coln<a class="anchor" aria-label="anchor" href="#arg-transspatlocs-coln"></a></dt>
<dd><p>the column name of 1st, 2nd, optional 3rd spatial dimension of each transcript in transcript_df</p></dd>


<dt id="arg-spatialmergecheck-method">spatialMergeCheck_method<a class="anchor" aria-label="anchor" href="#arg-spatialmergecheck-method"></a></dt>
<dd><p>use either "leidenCut" (in 2D or 3D) or "geometryDiff" (in 2D only) method to determine whether a cell pair merging event is allowed in space (default = "leidenCut")</p></dd>


<dt id="arg-cutoff-spatialmerge">cutoff_spatialMerge<a class="anchor" aria-label="anchor" href="#arg-cutoff-spatialmerge"></a></dt>
<dd><p>spatial constraint on a valid merging event between two source transcript groups, default = 0.5 for 50% cutoff, set to 0 to skip spatial constraint evaluation for merging.
For <code>spatialMergeCheck_method = "leidenCut"</code>, this is the minimal percentage of transcripts shared membership between query cell and neighbor cells in leiden clustering results for a valid merging event.
For <code>spatialMergeCheck_method = "geometryDiff"</code>, this is the maximum percentage of white space change upon merging of query cell and neighbor cell for a valid merging event.</p></dd>


<dt id="arg-leiden-config">leiden_config<a class="anchor" aria-label="anchor" href="#arg-leiden-config"></a></dt>
<dd><p>(leidenCut) a list of configuration to pass to reticulate and <code><a href="https://r.igraph.org/reference/cluster_leiden.html" class="external-link">igraph::cluster_leiden</a></code> function, including objective_function, resolution_parameter, beta, n_iterations.</p></dd>


<dt id="arg-config-spatnw-transcript">config_spatNW_transcript<a class="anchor" aria-label="anchor" href="#arg-config-spatnw-transcript"></a></dt>
<dd><p>(leidenCut) configuration list to create spatial network at transcript level, see manual for <code>createSpatialDelaunayNW_from_spatLocs</code> for more details, set to NULL to use default config</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list</p><ol><li><p>cells_to_discard, a vector of cell ID that should be discarded during resegmentation</p></li>
<li><p>cells_to_update, a named vector of cell ID where the cell_ID in name would be replaced with cell_ID in value.</p></li>
<li><p>cells_to_keep, a vector of cell ID that should be kept as it is.</p></li>
<li><p>reseg_full_converter, a single named vector of cell ID to update the original cell ID, assign NA for cells_to_discard.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Evaluate neighborhood information against score and transcript number cutoff to decide the resegmetation operations like the following:</p><ul><li><p>merge query to neighbor if consist cell type and fewer than average transcript number cutoff, higherCutoff_transNum;</p></li>
<li><p>keep query as new cell id if no consist neighbor cell type, but high self score and higher than minimal transcript number, lowerCutoff_transNum;</p></li>
<li><p>discard the rest of query cells that have no consistent neighbor cell type, fewer transcript number based on lowerCutoff_transNum, and/or low self score.
The function uses network component analysis to resolve any conflict due to merging multiple query cells into one.
When <code>cutoff_spatialMerge &gt; 0</code>, the function applies additional spatial constraint on a valid merging event of query cell into neighbor cell.</p></li>
<li><p>In case of <code>spatialMergeCheck_method = "leidenCut"</code>, the function builds spatial network at transcript level, does leiden clustering  on the spatial network, and then decides whether the merge should be allowed based on the observed shared leiden membership of the two source transcript groups for a putative merging event; the provided <code>cutoff_spatialMerge</code> gives the minimal values of shared leiden memberhsip for a valid merging event.</p></li>
<li><p>In case of <code>spatialMergeCheck_method = "geometryDiff"</code>, the function would first calculate white space, i.e. the area difference between convex and concave hulls, respectively, for query cell, neighbor cell, and the corresponding merged cell; and then calculate the white space difference between the merged cell and two separate cells and normalize that value with respect to the concave area of query and neighbor cells, respectively; lastly, allow a valid merging when the normalized white space difference upon merging for both query and neighbor cells are smaller than the provided <code>cutoff_spatialMerge</code>.</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Danaher, Lidan Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

